# DB/Lock

## MySQL 엔진의 잠금

### 글로벌 락

MySQL 서버 전체에 대한 읽기 또는 쓰기 잠금을 설정합니다. 글로벌 락은 `FLUSH TABLES WITH READ LOCK` 명령어로 설정할 수 있습니다. 이 명령어는 모든 테이블을 닫고, 읽기 잠금을 설정하여 다른 세션이 데이터를 변경하지 못하도록 합니다. 글로벌 락은 주로 백업 작업 중에 사용됩니다.

### 테이블 락

테이블 단위로 잠금을 설정합니다. 테이블 락은 `LOCK TABLES` 명령어로 설정할 수 있습니다. 예를 들어, `LOCK TABLES table_name READ`는 해당 테이블에 대해 읽기 잠금을 설정하고, `LOCK TABLES table_name WRITE`는 쓰기 잠금을 설정합니다. 테이블 락은 여러 세션이 동시에 동일한 테이블에 접근할 때 충돌을 방지하는 데 사용됩니다.

### 네임드 락

네임드 락은 특정 이름을 가진 잠금을 설정하는 방법입니다. 네임드 락은 `GET_LOCK` 명령어로 설정할 수 있습니다. 예를 들어, `SELECT GET_LOCK('my_lock', 10)`는 'my_lock'이라는 이름의 잠금을 10초 동안 시도합니다. 네임드 락은 애플리케이션 레벨에서 특정 리소스에 대한 동시 접근을 제어하는 데 유용합니다.

### 메타데이터 락

메타데이터 락은 테이블의 구조 변경 작업(예: `ALTER TABLE`, `DROP TABLE`) 중에 자동으로 설정되는 잠금입니다. 메타데이터 락은 해당 테이블에 대한 다른 작업이 완료될 때까지 기다리도록 하여 데이터 무결성을 유지합니다. 예를 들어, 한 세션이 테이블을 변경하는 동안 다른 세션이 해당 테이블에 접근하려고 하면, 두 번째 세션은 첫 번째 세션이 완료될 때까지 대기하게 됩니다.

## InnoDB 엔진의 잠금

### 레코드 락

InnoDB는 행 단위로 잠금을 설정합니다. 레코드 락은 특정 행에 대해 읽기 또는 쓰기 잠금을 설정합니다. 예를 들어, `SELECT ... FOR UPDATE` 명령어는 해당 행에 대해 쓰기 잠금을 설정하여 다른 세션이 해당 행을 변경하지 못하도록 합니다. 레코드 락은 동시성 제어와 데이터 무결성을 유지하는 데 중요한 역할을 합니다.

### 갭 락

갭 락은 특정 범위 내의 행에 대해 잠금을 설정합니다. 갭 락은 주로 인덱스 범위 검색 시에 사용됩니다. 예를 들어, `SELECT ... FOR UPDATE` 명령어가 인덱스 범위를 검색할 때, 해당 범위 내의 행뿐만 아니라 그 사이의 갭에도 잠금이 설정될 수 있습니다. 갭 락은 팬텀 리드 현상을 방지하는 데 도움이 됩니다.

### 넥스트 키 락

넥스트 키 락은 레코드 락과 갭 락을 결합한 형태의 잠금입니다. 넥스트 키 락은 특정 행과 그 앞의 갭에 대해 동시에 잠금을 설정합니다. 예를 들어, `SELECT ... FOR UPDATE` 명령어가 인덱스 범위를 검색할 때, 해당 행과 그 앞의 갭 모두에 잠금이 설정됩니다. 넥스트 키 락은 팬텀 리드 현상을 방지하고, 데이터 무결성을 유지하는 데 중요한 역할을 합니다.

### 자동 증가 락

InnoDB는 자동 증가 컬럼에 대해 특별한 잠금을 설정합니다. 자동 증가 락은 새로운 행이 삽입될 때마다 해당 컬럼의 값을 증가시키기 위해 사용됩니다. 이 잠금은 동시에 여러 세션이 자동 증가 컬럼에 접근할 때 충돌을 방지하는 데 도움이 됩니다. 예를 들어, 여러 세션이 동시에 새로운 행을 삽입하려고 할 때, 자동 증가 락은 각 세션이 고유한 값을 얻도록 보장합니다.
